---
date: 2023-08-22
---
# Partition strategy

Основная задача партиционирования - это равномерно распределить нагрузку по партициям и избежать образования **hot spot**, когда происходит перекос в нагрузке в сторону отдельных партиций.

Вне зависимости от стратегии ребалансировка может быть **ручной** или **автоматической**. Полностью автоматическая ребалансировка привлекательна отсутствием необходимости задействовать человека. Но сам процесс ребалансировки достаточно ресурсоемкий, требует времени и интенсивной работы IO и сети. При этом нужно сохранять работоспособность кластера на время ребалансировки, а значит продолжать обслуживать запросы. Такая нагрузка может неудачно складываться и превести к отказу.
Используют также **гибридный** подход, когда автоматически отследивается необходимость ребалансировки и предлагается что конкретно надо сделать. При этом итоговое решение что и когда делать, принимает человек.

## Key range

1. упорядочиваем документы/записи по ключу
1. партиции принадлежит определенный диапазон **ключей**

Достоинство: эффективные *range query* по ключу
Недостаток: возможно неравномерное распределение нагрузки. Например, если пишем логи/данные с датчиков IoT, а ключом выбран timestamp, то целый день будем писать только в одну партицию.

## Hash of key

1. для ключа документа/записи вычисляется хэш
1. партиции принадлежит определенный диапазон **хэшей**

Достоинство: равномерное, распределение определяется качеством хэш функции. Подходит для монотонно возрастающих ключей.
Недостаток: невозможность выполнения *range query*, потому что документы внутри и между партициями неупорядочены.

## Гибридный

Используется составной(*compound*) ключ, по первой части которого определяется партиция, а по второй можно сортировать документы и делать *range query*. Например, хэш можно вычислять от ID датчика IoT, а дальше сортировать его данные уже по timestamp.
Такой подход используется в Casandra и в состав ключа включаются несколько колонок.

---

## Источники

1. [[Designing Data-Intensive Applications book ]]. Chapter 6.

## Ссылки

1. link
