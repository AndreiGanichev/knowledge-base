---
date: 2023-08-13
---
# Single leader replication

Другие названия: *active/passive, master/slave, leader/follower*

Среди нод кластера выбирают *leader*, остальные считаются *followers*.

Все записи идут на лидера, лидер обеспечивает **порядок** выполнения операций записи и отвечает за **разрешение конкуретных операций**(что тоже можно свести к определению порядка между операциями). После записи на лидера данные(*replication log / change stream*) *синхронно или асинхронно* реплицируются на фоловеров.

Отказы нод:

1. follower
    1. поднимается новая нода
    1. новый фоловер "догоняет"(catch up) по данным лидера
    1. новый фоловер включается в работу кластера
1. leader. Восстановление после отказа лидера - это более сложный процесс, который называется *failover*. В случае асинхронной репликации есть риск потери данных. В рамках failover'a проиводится [[Leader election]].

Потеря данных - это само по себе плохо, но возможны и более сложные сценарии. Допустим данные помимо реплицирования отправляются в стороннюю систему. После падения лидера выбран новый, но часть добавленных данных потеряна для реплик, но ушла в сторонюю систему. Так вот новый лидер при вставке генерирует последовательный ID, который уже был создан ранее упавшим лидером и существует во внешней системе.

Single-leader является наиболее распространенной схемой репликации, причем не только в СУБД. Ее также используют Kafka, RabbitMq.
Пропускание записей через лидера делает репликацию более простой для понимания и делает нерелевантными проблемы [[Write conflicts|*concurrent* записей]]  - лидер решает локально конфликты и реплицируемые данные имеют определенный порядок. Но лидер в данной схеме является узким горлышком с точки зрения масштабируемости записи и отказоустойчивости.

## Replication lag

При single leader replication отставание реплики легко определить: лидер является источником правды и сравнив реплику с ним, можно понять отставание. Поэтому replication lag является стандартной метрикой, которую предоставляют СУБД.

---

## Источники

1. [[Designing Data-Intensive Applications book ]]. Chapter 5.

## Ссылки

1. #[[Replication]]
