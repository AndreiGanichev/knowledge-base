---
date: 2023-10-19
---
# Deadline

В распределенной системе со стороны клиента используется [[Timeout pattern]] и в случае истечения времени запрос отменяется. На практике запрос клиента может породить целую цепочку вызовов downstream сервисов. В целом такой цепочке стоит избегать, используя асинхронные коммуникации, но тем не менее такая ситуация возможна.

**Проблема:** сервис в цепочке не знает таймаут на исходный запрос и не знает сколько из этого таймаута уже израсходовали upstream сервисы. При неоптимальных настройках какой-то процент запросов заведомо не будет выполнен до конца, но при этом обработка будет начата и будут расходоваться ресурсы сервиса.

**Решение:** на стороне клиента определить и передать в запросе *deadline*. Каждый сервис в цепочке должен перед вызовом downstream сервиса вычесть из полученного дедлайна то время, которое он уже израсходовал. А сервис при получении запроса должен проверять полученный дедлайн и даже не начинать обработку запроса, если он точно не уложится в полученный дедлайн.

---

## Источники

1. link

## Ссылки

1. [GRPC deadline](https://grpc.io/docs/guides/deadlines/#:~:text=in%20this%20document.-,Deadlines%20on%20the%20Client,realistic%20deadline%20in%20your%20clients.)
