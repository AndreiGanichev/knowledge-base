---
date: 2023-08-15
---
# Quorum or quorum consistency

Это способ обеспечения согласованности в распределенной системе, когда задается минимальное количество успешных ответов от нод кластера, чтобы операция в целом считалась успешной. При этом запросы могут отправляться на все ноды, но синхронно ждать ответа нужно только от минимального количества нод.

Используется в частности в алгоритмах [[Leaderless replication]].

```n``` - количество реплик
```w``` - минимальное количество реплик, которые должны ответить успешно, чтобы операция **записи** считалась успешной.
```r``` - минимальное количество реплик, которые должны ответить успешно, чтобы операция **чтения** считалась успешной.

Для обеспечения согласованности, необходимо выполнения условия ```w + r > n```, то есть чтобы множества реплик на чтение и на запись пересекались. Тогда гарантируется, что хотя бы одна реплика отдаст на чтение актуально значение. "Актуальное значение" определяется согласно принятой [[Write conflicts|стратегии разрешения конфликтов]].

## Достоинства

1. повышается [[Availability]] и [[Reliability|fault tolerance]]: кластер в целом может работать даже при отказе отдельных нод, главное чтобы для выполнения операций были доступны ```w``` и ```r``` нод соответственно.
1. гибкость настройки: можем оптимизировать конфигурацию под конкретный профиль нагрузки. Если мало записей и много чтения, то можно выбрать конфигурацию ```w = n, r = 1```.

Еще больше *availability* обеспечивает [[Sloppy quorum]].

## Недостатки

1. по сравнению с [[Single leader replication]] увеличивается [[Latency]], потому чтотак или иначе синхронно ждем ответа от нескольких реплик
1. возможны различные аномалии из-за рассогласования данных:
    - записали на w реплик, но часть из них упала, а те которые их заменили были при старте наполнены данными без этих записей. В этом случае чтение r реплик не гарантирует получение наиболее свежих данных
    

---

## Источники

1. link

## Ссылки

1. [[Majority vs ISR]]
1. [[Sloppy quorum]]
