---
date: 2024-02-29
---
# Total order broadcast (TOB)

Это протокол доставки сообщений, который дает гарантии:

1. надежная доставка - сообщения не теряются. При этом не дается гарантий на время доставки.
1. общий порядок - на все получатели сообщения будут доставлены в одном и том же порядке

В отличие от *timestamp ordering*, порядок к моменту доставки сообщения уже определен. В случае *timestamp ordering*  (например [[Lampord clock]] обеспечивает *total order*) можно упорядочить все сообщения, но уже пост фактум, потому что в процессе работы всегда может появиться сообщение, которое должно быть встроено куда-то между уже обработанными сообщениями. В случае использования total order broadcast сообщение может быть *receive* раньше времени, но *deliver* (см. [[Broadcast]])произойдет только когда подойдет его очередь в общем порядке.

Как упоминается [[Ordering|в этой заметке]] существует связь ordering-linearizability.

## TOB на основе линеаризуемого хранилища

Пусть в линеаризуемом хранилище хранится счетчик, поддерживающий операцию *increment-and-get*. Каждая нода перед тем как отправить сообщение обращается к этому счетчику, получает очередной индекс и прикладывает его к сообщению. Таким образом сообщения будут строго упорядочены и **без пробелов** в индексе.

Клепман пишет, что пробелы могут быть при использовании [[Lampord clock]]. Я так понимаю речь про то, что если до получателя дошли сообщения с метками ```(индекс операции, номер ноды)``````: (3,1) и (4,2), то ничего нельзя сказать придет ли какое-то сообщение между ними или нет. Потому что например может прийти сообщение (3,2) или (4,1), которое должно быть упорядочено между данными.

А вот в случае TOB если receive сообщение с индексом 2, а теперь пришло с индексом 4, то можно быть уверенным, что 4 надо отложить и подождать пока придет 3.

## Реализац

---

## Источники

1. link

## Ссылки

1. #[[Broadcast]]
