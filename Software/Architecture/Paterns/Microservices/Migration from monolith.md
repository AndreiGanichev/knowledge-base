---
date: 2025-11-06
---
# Migration from monolith

Сэм Ньюман в [1] рекомендует:

1. много акцентирует внимание на итеративном отпиле микросервисов небольшими частями:
    - быстрее отпиленная часть выйдет в прод
    - быстрее получим реальный фидбек
    - быстрее поймем, что совершили ошибку(неизбежно)
    - если делаем ошибку, то небольшой бласт радиус
1. заранее определиться с целями отпила и метриками, по которым можно было бы отслеживать прогресс

## Паттерны

Во многом паттерны распила монолита сосредоточены на том, чтобы обеспечить:

1. возможность инрементальной реализации микросервиса. Это предполагает [[Continious Integration]], а не просто длительную работу в отдельной ветке, деплой микросервиса(пусть даже сначала без рабочего функицонала) на прод.
1. возможность быстрого [[Make decisions reversible|отката]] на текущее монолитное решение

### Разделение логики

1. [[Strangler fig pattern]]
1. [[Branch by abstraction pattern]]
1. [[Parallel run pattern]]
1. [[Decorator collaborator pattern]]
1. [[Change data capture patterm]]

### Разделение данных

При разделении данных существует два варианта:

1. логическое - разные схемы в одном сервере БД. Обеспечивает [[Information hiding]] и в перспективе позволяет гораздо легче перейти к физическому разделению. Этот подход используется в [[Modular monolith|модульном монолите]]. Дополнительным преимуществом может быть возможность шаринга view между схемами, зависит от возможностей конкретной СУБД.
1. физическое - разные сервера БД. Целью этого варианта является независимость ресурсов и, сответственно, возможность независимого масштабирования




### Последовательность разделения

#### Code first

Достоинства: сразу виден результат и появляется возможность независимого масштабирования нового микросервиса
Недостатки: легко застрять на этом этапе, а без разделения данных - это не будет полноценный отпил

#### Database first

Достоинства:

1. часто разделение данных является наиболее сложным этапом. Начав с данных, мы повышаем шансы, что дойдем до полноценного выделения микросервиса(если это действительно нужно - см. п.2)
1. с другой стороны, может оказаться так, что обеспечив изоляцию данных, решится часть вопросов, например, повысится [[Modularity|модульность]], а вслед за ней и [[Maintainability]]. Это ускорит одновременную разработку разных команд в монолите. Т.е. подход зависит от цели распила монолита и Ньюман еще в начале книги акцентирует внимание на необходимости понимать какие именно проблемы мы хоти решить распилом.

Недостатки:

1. несет прежде всего профит в долгосроке, а сразу после выполнения этого разделения профита не будет
1. ухудшается производительность: если нужны данных из разделенных БД, то придется join делать в памяти
1. разрываются границы транзации, если она распространяется на данные в разных БД. Но тут возникает сразу вопрос: правильно ли мы разделяем данные, если нужна такая транзакция. Скорее всего неправильно.

#### Code + Database

Недостатки:

1. сложно обеспечить главные принципы распила, которые транслирует Ньюман: инкрементальные изменения и возможность быстрого отката

---

## Источники

1. [[Monolith to microservices book]]

## Ссылки

1. [[Microservices]]
