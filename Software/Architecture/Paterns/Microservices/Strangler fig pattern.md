---
date: 2025-11-05
---
# Strangler fig

Это паттерн выноса функционала из монолита в отдельный сервис. Он особенно ценный, когда нет возможности вносить изменения в монолит.

## Ограничение

Требуется, чтобы доступ к отпиливаемому функицоналу был через публичный API монолита(http, очередь). Это необходимо для переключения трафика на новый сервис без изменения самого монолита

## Описание

Паттерн предполагает три этапа:

1. между клиентом и монолитом добавляем прокси, если его еще нет
1. разворачиваем новый сервис
1. переносим функционал в новый сервис
1. на прокси переключаем трафик на новый сервис

Могут быть разные опции:

1. можно начать с частичного переключения трафика(*canary realese*)
1. если такие возможности есть в прокси, то можно перенести часть функционала в сервис и направить именно эту часть трафика в него. Например, роутинг настроить исходя из URL

## Поддерживаемые протоколы

Проще всего переключать трафик, если используется http, потому что в нем заложены такие возможности и существующие прокси позволяют это делать. Но паттерн применим и для других протоколов. Например, его можно использовать и для консьюма событий. В этом случае для одной и той же очереди появится два консьюмера есть два варианта:

1. получать все события и в новом сервисе, и в монолите. И скипать ненужные типы событий:
    - требуется вносить изменения в монолит
    - требуется синхронизация релиза монолита и нового сервиса. И соответственно синхронизация в случае отката
2. реализовать роутинг нужных событий в новый сервис, а другие оставить в монолит

---

## Источники

1. [[Monolith to microservices book]]

## Ссылки

1. [Strangler Fig](https://martinfowler.com/bliki/StranglerFigApplication.html)
