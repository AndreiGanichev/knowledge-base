---
date: 2025-11-07
---
# Branch by abstraction

Паттерн отпила сикросервиса от монолита. В отличие от [[Strangler fig]] подходит для случаев, когда вызовы к отпиливаемому функционалу происходят внутри монолита.

## Ограничения

Должна быть возможность вносить изменения в монолит.

## Описание

По сути является более общим паттерном, суть которого в добавлении [[Abstraction|абстракции]] для отпиливаемого функционала. Это позволяет в монолите сделать альтернативную реализацию, которая выполняет вызов нового микросервиса. Для переключения между реализациями используют *feature toggle*.

Этапы:

1. выделение абстракции
1. переключения кода в монолите на работу с абстракцией
1. создание микросервиса и добавление новой реализации, обращающейся к микросервису
1. переключение на новую реализацию
1. удаление монолитной реализации и абстракции(если целесообразно)

Паттерн позволяет достичь основных целей при отпиле: деплой самого микросервиса и новая реализация абстракции может выполняться параллельно с текущими задачами и не влечет конфликтов при слиянии кода. Переключение на микросервис является откатываемым.

Монолитная реализация может выполнять функции fallback'a в случае отказа микросервиса. Развитием решения может быть [[Parallel run]]: для валидации работы микросервиса можно сравнивать его ответ с ответом монолитной реализации.

---

## Источники

1. [[Monolith to microservices book]]

## Ссылки

1. [[Migration from monolith]]
