---
date: 2022-05-28
tags:
    - tag
---

*Event sourced domain model* - это доменная модель, хранение изменений состояния агрегатов которых реализовано с помощью паттерна [[Event sourcing]]. Состояние агрегата является одной из возможных *projections* последовательности событий. В отличии от традиционной доменной модели любое изменение состояния агрегата должно пораждать событие.

Такая модель существенно расширяет возможности по изучению домена и оптимизации системы через анализ событий и построение новых проекций по необходимости. Аналитика и макисмальное погружение в домен актуальны в первую очередь для *core subdomains*.

Построение проекций также активно используется в [[CQRS]]


 ### Преимущества

1. можно переводить систему в требуемое состояние в прошлом. Это помогает при исследовании поведений системы для изучения домена или дебага(можно восстановить состояние агрегата на момент проявления дефекта)
1. можно добавлять новые проекции событий для нужд аналитики
1. аудит лог из коробки, что для некоторых доменов обязательно по закону. Ведение строго согласованного лога - это нетривиальная задача с точки зрения границ транзакции. Плюс если вести его отдельно, то он не является источником правды, что ведет к его загниванию со временем - фичи будут работать и без него.
1. можно реализовать более интеллектуальный [[Concurrency control]]: при обнаружении конфликта смотрим какие именно были изменения в конкуррентном процессе и мешают ли они закомититься текущему процессу

### Недостатки

1. добавляет архитектурную сложность и сложность в реализации, что требует определенной квалификации разработчиков или времени на изучение
    1. что если событий очень много - *snapshot pattern*
    1. как удалять данные, если это нужно по закону - *forgettable payload pattern*
    1. как версионировать события - книга Грега Янга

### Когда применять

Применение ES доменной модели как и любые решения в проектировании с использованием DDD должны быть согласовано с нуждами и стратегией бизнеса([[Software/Architecture/Software architecture/DDD/Basics]]): core subdomain, требующий детального изучения и оптимизаций, поиска новых возможносте и инсайтов. Или требования закона по аудит логу.

---

### Источники:
1. Learning DDD. Chapter 7. Modelling the dimension of time. Vladik Khononov

### Ссылки:
1. [[Subdomain]]
1. Versioning in event sourced systems. Greg Young