---
date: 2023-02-02
tags:
    - tag
---

**Масштабируемость** - это способность системы справляться с ростом нагрузки. 

Чаще всего масштабируемость связана с *performance*:
1. увеличиваем нагрузку на X, оставляя ресурсы те же, и смотрим как ведет себя система
1. задаемся вопросом: сколько нод, CPU, памяти нужно добавить, чтобы иметь возможность выдержать нагрузку X?


## Нагрузка

Нагрузка бывает разная. Для ее описания рассматривают конкретные **load parameters**:
1. количество активных пользователей
1. количество запросов в секунду для веб сервисов
1. количество публикуемых сообщений в случае обработки сообщений из очереди
1. количество записей и чтений для БД
1. hit rate для кэша

Для разных приложений важны разные параметры. Как и в случае с [[Reliability]] и разными видами *faults* нельзя быть готовым к любому виду нагрузки. Мы должны предполагать как именно будет расти нагрузка на систему и быть готовым к этому виду нагрузки. Не существует готового решения, которое решало бы проблему масштабирования для всех приложений(*one size fit all*). Наоборот в каждом конкретном случае архитектор комбинирует general purpose решения, используя извстные паттерны, чтобы получить масштабируемую систему именно для его случая.

> For example, a system that is designed to handle 100,000 requests per second, each 1 kB in size, looks very different from a system that is designed for 3 requests per minute, each 2 GB in size—even though the two systems have the same data through‐ put.

### Twitter
Например, для Twitter при росте общего кол-ва пользователей, RPS на чтение ленты будет расти значительно быстрее RPS на публикацию твитов, потому что большинство пользователей только читают. Поэтому именно запросы на чтение ленты будут основным направлением роста нагрузки в процессе развития системы.

> An architecture that scales well for a particular application is built around assump‐ tions of which operations will be common and which will be rare—the load parame‐ ters.

Load parameters Twitter это:
1. 4.6k rps на публикацию твитов в среднем, 12k в пике
1. Объем твита. Не знаю, но из-за ограничение на кол-во символов, этот параметр не должен доставлять проблем
1. 300k rps на чтение ленты новостей
1. **fan-out** до 31М(количество подписчиков)

Значение fan-out во многом определяет арх решение:
1. маленький: можно добавлять твит в ленту каждому фоловеру в момент публикации твита. Когда пользователь запрашивает ленту, отдаем ему готовый, заранее сформированный результат
1. большой: сохранять во все ленты в момент публикации будет слишком дорого и тогда выгоднее ленту формировать в момент запроса конкретного пользователя

В итоге на практике используется комбинированное решение, потому что среди большинства обычных пользователей с небольшим кол-вом подписчиок есть celebrities  с миллионами подписчиков.

## Производительность

Для оценки масштабируемости(как система справляется с ростом нагрузки), необходимо отслеживать метрики *performance*

---

### Источники:
1. [[Designing Data-Intensive Applications book]]. Chapter 1.

### Ссылки:
1. [[Horizontal scaling]]#
1. [[Vertical scaling]]#
1. [[Performance]]