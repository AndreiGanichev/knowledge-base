---
date: 2023-03-27
tags:
    - tag
---

# Log-structured merge-tree

Это подход к хранению данных, который предполагает:

1. при записи данные записываются в структуру в памяти - [[Memtable]].
1. когда размер *memtable* превышает пороговое значение, создается новый файл([[SSTable]] segment) на диске и туда записывается содержимое memtable. Так обеспечивается упорядоченность данных по ключу внутри *SSTable*. Ключи в memtable уникальны, а значит они не повторяются и в *SSTable*. В момент создания сегмента на диске создается новый экземпляр memtable, в которую продолжается запись, а предыдыдущая memtable тем временем сохраняется на диск.
1. чтение данных производится в следующем порядке: сначала проверяется *memtable*, а потом сегменты, начиная с самого последнего
1. фоновый процесс выполняет *merge* сегментов

## Особенности реализации

1. Чтобы не потерять текущие данные в memtable в случае отказа, ведется параллельно лог записей, типа [[Write ahead log]]. В нем данные уже неупорядочены, но его задача - только обеспечить восстановление (recovery) в случае отказа.
1. Исходя из описанного алгоритма работы операция поиска по несуществующему в хранилище ключу будет очень неэффективна - придется проверить последовательно все сегменты на диске. Чтобы оптимизировать этот процесс используют [[Bloom filter]]

---

## Источники

1. [[Designing Data-Intensive Applications book]]. Chapter 3.

## Ссылки

1. #[[Log structured storage]]
