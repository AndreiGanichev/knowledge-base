---
date: 2023-12-26
---
# Testing basics

## Unit

Обычно это тестирование на уровне класса. Основное назначение - тестирование поведения класса или группы классов.

В зависимости от отношения к [test doubles](https://martinfowler.com/bliki/TestDouble.html) различают два подхода:

1. sociable - юнит тестируется как черный ящик и при тестировании(arrange, assert) используется только его публичный api.
1. solitary - юнит тестируется в изоляции, а его зависимости заменяются на test doubles. Такие тесты имеют бОльшую связанность с реализацией тестируемого юнита.

![Unit testing](./Images/Unit%20testing.png)

Цель юнит тестов репозиториев и gateways в проверке логики взаимодействия с out-of-process зависимостями: корректное формирование запроса, правильная обработка ответа и маппинг из/в доменную модель. Использование в таких тестах test doubles вместо реальных внешних зависимостей делает тесты более быстрыми, а также позволяет легко имитировать нужное поведение зависимости. Например, возврат нужных ошибок или таймауты.

На уровне сервисов и resources(подразумевается маппер между протоколом общения сервиса и доменной моделью) тестируется координационная логика(оркестрация). В данном случае test doubles также упрощают жизнь. Потому что задача не протестировать доменную логику, а именно проверить координацию.

## Integration

Интеграционные тесты тестируют взаимодействие нескольких модулей, обращаясь уже к некоторой подсистеме, и проверяют уже поведение подсистемы в целом, а также возможные ошибки работы с интерфейсами модулей.

Несмотря на то, что скоуп, покрываемый интеграционными тестами может быть различный, автор пишет, что в микросервисах интеграционные тесты обычно ограничиваются проверкой интеграции со сторонними системами: хранилище, внешние сервисы. Основной целью является проверка правильности интеграции, а не тестирование внешней зависимости.

![Integration tests scope](./Images/Integration%20tests%20scope.png)

> **Gateway** integration tests allow any protocol level errors such as missing HTTP headers, incorrect SSL handling or request/response body mismatches to be flushed out at the finest testing granularity possible.

> **Persistence** integration tests provide assurances that the schema assumed by the code matches that available in the data store.

Solitary unit тесты для внешних зависимостей имеют похожий скоуп, но они не охватывают реальное взаимодействие с внешней зависимостью и используют *test doubles* вместо HttpClient, ORM или коннектора к БД.

## Contract

Интеграционные тесты имеют больше одной причины для изменений: помимо ошибки на "нашей" стороне, они могут падать из-за недоступности внешней зависимости или сломанных на ее стороне контрактов. Для точечной проверки последнего случая существуют **контрактные тесты**.

---

## Источники

1. [Microservice testing](https://martinfowler.com/articles/microservice-testing)

## Ссылки

1. [FIRST principles of unit testing](https://agileinaflash.blogspot.com/2009/02/first.html)
